{% extends 'blog/base.html' %}

{% block title %}Reply to Comment - {{ post.title }}{% endblock %}

{% block content %}
<div class="comment-reply-container">
    <div class="comment-reply-header">
        <h2>Reply to Comment</h2>
        <p class="comment-reply-subtitle">On "{{ post.title }}"</p>
    </div>
    
    <div class="comment-reply-card">
        <div class="original-comment">
            <h4>Replying to {{ parent_comment.author.username }}'s comment:</h4>
            <div class="comment-preview">
                <div class="comment-header">
                    <strong>{{ parent_comment.author.username }}</strong>
                    <span>{{ parent_comment.created_at|date:"F d, Y H:i" }}</span>
                </div>
                <div class="comment-content">
                    {{ parent_comment.content|linebreaks }}
                </div>
            </div>
        </div>
        
        <form method="POST" class="comment-reply-form">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="alert alert-danger">
                <strong>Please correct the errors below:</strong>
                <ul>
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <div class="form-group">
                <label for="{{ form.content.id_for_label }}">Your Reply</label>
                {{ form.content }}
                <div class="char-counter" id="reply-counter">
                    <span id="reply-chars">0</span>/1000 characters
                </div>
            </div>
            
            {{ form.parent }}
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-reply"></i> Post Reply
                </button>
                
                <a href="{% url 'post-detail' post.pk %}" class="btn btn-outline-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const contentInput = document.getElementById('{{ form.content.id_for_label }}');
        const replyChars = document.getElementById('reply-chars');
        
        if (contentInput && replyChars) {
            function updateCounter() {
                replyChars.textContent = contentInput.value.length;
                
                // Change color when approaching limit
                if (contentInput.value.length > 900) {
                    replyChars.style.color = '#ffc107';
                } else if (contentInput.value.length > 950) {
                    replyChars.style.color = '#dc3545';
                } else {
                    replyChars.style.color = '#6c757d';
                }
            }
            
            contentInput.addEventListener('input', updateCounter);
            updateCounter(); // Initialize
        }
    });
</script>
{% endblock %}
