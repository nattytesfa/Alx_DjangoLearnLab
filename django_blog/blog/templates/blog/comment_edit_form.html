{% extends 'blog/base.html' %}

{% block title %}Edit Comment - {{ object.post.title }}{% endblock %}

{% block content %}
<div class="comment-edit-container">
    <div class="comment-edit-header">
        <h2>Edit Your Comment</h2>
        <p class="comment-edit-subtitle">On "{{ object.post.title }}"</p>
    </div>
    
    <div class="comment-edit-card">
        <form method="POST" class="comment-edit-form" id="commentEditForm">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="alert alert-danger">
                <strong>Please correct the errors below:</strong>
                <ul>
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <div class="original-comment">
                <h4>Original Comment ({{ object.created_at|date:"F d, Y" }}):</h4>
                <div class="comment-preview">
                    {{ object.content|linebreaks }}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ form.content.id_for_label }}">Edit Comment</label>
                {{ form.content }}
                <div class="char-counter" id="comment-counter">
                    <span id="comment-chars">0</span>/1000 characters
                </div>
                <div class="form-help">
                    <i class="fas fa-info-circle"></i> Editing will mark the comment as "edited".
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Update Comment
                </button>
                
                <a href="{% url 'post-detail' object.post.pk %}" class="btn btn-outline-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
                
                <a href="{% url 'comment-delete' object.pk %}" class="btn btn-outline-danger">
                    <i class="fas fa-trash"></i> Delete
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const contentInput = document.getElementById('{{ form.content.id_for_label }}');
        const commentChars = document.getElementById('comment-chars');
        
        if (contentInput && commentChars) {
            function updateCounter() {
                commentChars.textContent = contentInput.value.length;
                
                // Change color when approaching limit
                if (contentInput.value.length > 900) {
                    commentChars.style.color = '#ffc107';
                } else if (contentInput.value.length > 950) {
                    commentChars.style.color = '#dc3545';
                } else {
                    commentChars.style.color = '#6c757d';
                }
            }
            
            contentInput.addEventListener('input', updateCounter);
            updateCounter(); // Initialize
        }
    });
</script>
{% endblock %}
